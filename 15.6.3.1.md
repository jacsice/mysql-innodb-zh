#### 15.6.3.1 The System Tablespace

The system tablespace is the storage area for the change buffer. It may also contain table and index data if tables are created in the system tablespace rather than file-per-table or general tablespaces. In previous MySQL versions, the system tablespace contained the `InnoDB` data dictionary. In MySQL 8.0, `InnoDB` stores metadata in the MySQL data dictionary. See [Chapter 14, *MySQL Data Dictionary*](https://dev.mysql.com/doc/refman/8.0/en/data-dictionary.html). In previous MySQL releases, the system tablespace also contained the doublewrite buffer storage area. This storage area resides in separate doublewrite files as of MySQL 8.0.20. See [Section 15.6.4, “Doublewrite Buffer”](https://dev.mysql.com/doc/refman/8.0/en/innodb-doublewrite-buffer.html).

> 系统表空间是更改缓冲区的存储区域。如果表是在系统表空间而不是 file-per-table 或通用表空间中创建的，它还可能包含表和索引数据。在以前的 MySQL 版本中，系统表空间包含“InnoDB”数据字典。在 MySQL 8.0 中，`InnoDB` 将元数据存储在 MySQL 数据字典中。请参阅 [第 14 章，*MySQL 数据字典*](https://dev.mysql.com/doc/refman/8.0/en/data-dictionary.html)。在以前的 MySQL 版本中，系统表空间还包含双写缓冲区存储区域。自 MySQL 8.0.20 起，此存储区域位于单独的双写文件中。请参阅 [第 15.6.4 节，“双写缓冲区”](https://dev.mysql.com/doc/refman/8.0/en/innodb-doublewrite-buffer.html)。

The system tablespace can have one or more data files. By default, a single system tablespace data file, named `ibdata1`, is created in the data directory. The size and number of system tablespace data files is defined by the [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) startup option. For configuration information, see [System Tablespace Data File Configuration](https://dev.mysql.com/doc/refman/8.0/en/innodb-init-startup-configuration.html#innodb-startup-data-file-configuration).

> 系统表空间可以有一个或多个数据文件。默认情况下，会在数据目录中创建一个名为“ibdata1”的系统表空间数据文件。系统表空间数据文件的大小和数量由 [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) 启动选项定义。

Additional information about the system tablespace is provided under the following topics in the section:

- [Resizing the System Tablespace](https://dev.mysql.com/doc/refman/8.0/en/innodb-system-tablespace.html#innodb-resize-system-tablespace)
- [Using Raw Disk Partitions for the System Tablespace](https://dev.mysql.com/doc/refman/8.0/en/innodb-system-tablespace.html#innodb-raw-devices)

##### Resizing the System Tablespace



This section describes how to increase or decrease the size of the system tablespace.

###### Increasing the Size of the System Tablespace

The easiest way to increase the size of the system tablespace is to configure it to be auto-extending. To do so, specify the `autoextend` attribute for the last data file in the [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) setting, and restart the server. For example:

> 增加系统表空间大小的最简单方法是将其配置为自动扩展。在 [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) 配置中为最后一个数据文件指定 `autoextend` 属性，然后重新启动服务器。

```ini
innodb_data_file_path=ibdata1:10M:autoextend
```

When the `autoextend` attribute is specified, the data file automatically increases in size by 8MB increments as space is required. The [`innodb_autoextend_increment`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_autoextend_increment) variable controls the increment size.

>当指定 `autoextend` 属性时，数据文件的大小会随着空间的需要自动增加 8MB。 [`innodb_autoextend_increment`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_autoextend_increment) 变量控制增量大小。

You can also increase system tablespace size by adding another data file. To do so:

1. Stop the MySQL server.
2. If the last data file in the [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) setting is defined with the `autoextend` attribute, remove it, and modify the size attribute to reflect the current data file size. To determine the appropriate data file size to specify, check your file system for the file size, and round that value down to the closest MB value, where a MB is equal to 1024 x 1024 bytes.
3. Append a new data file to the [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) setting, optionally specifying the `autoextend` attribute. The `autoextend` attribute can be specified only for the last data file in the [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) setting.
4. Start the MySQL server.

>1. 停止 MySQL 服务器。
>2. 如果[`innodb_data_file_path 配置中的最后一个数据文件是用`autoextend`属性定义的，删除它，并修改 size 属性为当前数据文件的大小。要确定要指定的适当数据文件大小，请检查文件系统的文件大小，然后将该值向下舍入到最接近的 MB 值，其中 MB 等于 1024 x 1024 字节。
>3. 将新数据文件附加到 [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) 设置，可选择指定 `autoextend` 属性.只能为 [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) 设置中的最后一个数据文件指定 `autoextend` 属性。
>4. 启动 MySQL 服务器。

For example, this tablespace has one auto-extending data file:

> 比如：这个表空间有一个自动扩展的数据文件

```none
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:10M:autoextend
```

Suppose that the data file has grown to 988MB over time. This is the [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) setting after modifying the size attribute to reflect the current data file size, and after specifying a new 50MB auto-extending data file:

>假设数据文件随时间增长到 988MB。修改size 属性为当前数据文件大小，以及指定新的 50MB 自动扩展数据文件：

```none
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:988M;/disk2/ibdata2:50M:autoextend
```

When adding a new data file, do not specify an existing file name. `InnoDB` creates and initializes the new data file when you start the server.

>添加新数据文件时，不要指定现有文件名。 `InnoDB` 在你启动服务器时创建并初始化新的数据文件。

Note

You cannot increase the size of an existing system tablespace data file by changing its size attribute. For example, changing the [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) setting from `ibdata1:10M:autoextend` to `ibdata1:12M:autoextend` produces the following error when starting the server:

> 不能通过更改其大小属性来增加现有系统表空间数据文件的大小。例如，将 [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) 设置从 `ibdata1:10M:autoextend` 更改为 `ibdata1: 12M:autoextend` 在启动服务器时会产生以下错误：

```terminal
[ERROR] [MY-012263] [InnoDB] The Auto-extending innodb_system
data file './ibdata1' is of a different size 640 pages (rounded down to MB) than
specified in the .cnf file: initial 768 pages, max 0 (relevant if non-zero) pages!
```

The error indicates that the existing data file size (expressed in `InnoDB` pages) is different from the data file size specified in the configuration file. If you encounter this error, restore the previous [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) setting, and refer to the system tablespace resizing instructions.

> 该错误表明现有数据文件大小（以`InnoDB`页面表示）与配置文件中指定的数据文件大小不同。如果遇到这个错误，恢复之前的[`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path)设置，参考系统表空间大小调整指示。

###### Decreasing the Size of the InnoDB System Tablespace

Decreasing the size of an existing system tablespace is not supported. The only option to achieve a smaller system tablespace is to restore your data from a backup to a new MySQL instance created with the desired system tablespace size configuration.

>不支持减小现有系统表空间的大小。实现更小的系统表空间的唯一选择是将数据从备份恢复到使用所需系统表空间大小配置创建的新 MySQL 实例。

For information about creating backups, see [Section 15.18.1, “InnoDB Backup”](https://dev.mysql.com/doc/refman/8.0/en/innodb-backup.html).

For information about configuring data files for a new system tablespace. See [System Tablespace Data File Configuration](https://dev.mysql.com/doc/refman/8.0/en/innodb-init-startup-configuration.html#innodb-startup-data-file-configuration).

To avoid a large system tablespace, consider using file-per-table tablespaces or general tablespaces for your data. File-per-table tablespaces are the default tablespace type and are used implicitly when creating an `InnoDB` table. Unlike the system tablespace, file-per-table tablespaces return disk space to the operating system when they are truncated or dropped. For more information, see [Section 15.6.3.2, “File-Per-Table Tablespaces”](https://dev.mysql.com/doc/refman/8.0/en/innodb-file-per-table-tablespaces.html). General tablespaces are multi-table tablespaces that can also be used as an alternative to the system tablespace. See [Section 15.6.3.3, “General Tablespaces”](https://dev.mysql.com/doc/refman/8.0/en/general-tablespaces.html).

> 为避免使用大型系统表空间，请考虑使用 file-per-table 表空间或通用表空间。 File-per-table 表空间是默认表空间类型，在创建“InnoDB”表时隐式使用。与系统表空间不同，file-per-table 表空间在被截断或删除时会将磁盘空间返回给操作系统。通用表空间是多表表空间，也可以用作系统表空间的替代品。



##### Using Raw Disk Partitions for the System Tablespace

Raw disk partitions can be used as system tablespace data files. This technique enables nonbuffered I/O on Windows and some Linux and Unix systems without file system overhead. Perform tests with and without raw partitions to verify whether they improve performance on your system.

When using a raw disk partition, ensure that the user ID that runs the MySQL server has read and write privileges for that partition. For example, if running the server as the `mysql` user, the partition must be readable and writeable by `mysql`. If running the server with the [`--memlock`](https://dev.mysql.com/doc/refman/8.0/en/server-options.html#option_mysqld_memlock) option, the server must be run as `root`, so the partition must be readable and writeable by `root`.

> 原始磁盘分区可以用作系统表空间数据文件。这种技术可以在 Windows 和一些 Linux 和 Unix 系统上实现非缓冲 I/O，而无需文件系统开销。通过测试使用和不使用原始分区，验证它们是否提高了你的系性能。
>
> 使用原始磁盘分区时，请确保运行 MySQL 服务器的用户 ID 对该分区具有读写权限。例如，如果以 `mysql` 用户运行服务器，则分区必须是 `mysql` 可读写的。如果使用 [`--memlock`](https://dev.mysql.com/doc/refman/8.0/en/server-options.html#option_mysqld_memlock) 选项运行服务器，则服务器必须以 `root 身份运行`，因此该分区必须可由 `root` 读写。

The procedures described below involve option file modification. For additional information, see [Section 4.2.2.2, “Using Option Files”](https://dev.mysql.com/doc/refman/8.0/en/option-files.html).

###### Allocating a Raw Disk Partition on Linux and Unix Systems

1. When creating a new data file, specify the keyword `newraw` immediately after the data file size for the [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) option. The partition must be at least as large as the size that you specify. Note that 1MB in `InnoDB` is 1024 × 1024 bytes, whereas 1MB in disk specifications usually means 1,000,000 bytes.

   ```none
   [mysqld]
   innodb_data_home_dir=
   innodb_data_file_path=/dev/hdd1:3Gnewraw;/dev/hdd2:2Gnewraw
   ```

2. Restart the server. `InnoDB` notices the `newraw` keyword and initializes the new partition. However, do not create or change any `InnoDB` tables yet. Otherwise, when you next restart the server, `InnoDB` reinitializes the partition and your changes are lost. (As a safety measure `InnoDB` prevents users from modifying data when any partition with `newraw` is specified.)

3. After `InnoDB` has initialized the new partition, stop the server, change `newraw` in the data file specification to `raw`:

   ```none
   [mysqld]
   innodb_data_home_dir=
   innodb_data_file_path=/dev/hdd1:3Graw;/dev/hdd2:2Graw
   ```

4. Restart the server. `InnoDB` now permits changes to be made.

###### Allocating a Raw Disk Partition on Windows

On Windows systems, the same steps and accompanying guidelines described for Linux and Unix systems apply except that the [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) setting differs slightly on Windows.

1. When creating a new data file, specify the keyword `newraw` immediately after the data file size for the [`innodb_data_file_path`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_file_path) option:

   ```none
   [mysqld]
   innodb_data_home_dir=
   innodb_data_file_path=//./D::10Gnewraw
   ```

   The `//./` corresponds to the Windows syntax of `\\.\` for accessing physical drives. In the example above, `D:` is the drive letter of the partition.

2. Restart the server. `InnoDB` notices the `newraw` keyword and initializes the new partition.

3. After `InnoDB` has initialized the new partition, stop the server, change `newraw` in the data file specification to `raw`:

   ```none
   [mysqld]
   innodb_data_home_dir=
   innodb_data_file_path=//./D::10Graw
   ```

4. Restart the server. `InnoDB` now permits changes to be made.