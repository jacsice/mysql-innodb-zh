#### 15.6.2.1 Clustered and Secondary Indexes



Each `InnoDB` table has a special index called the clustered index that stores row data. Typically, the clustered index is synonymous with the primary key. To get the best performance from queries, inserts, and other database operations, it is important to understand how `InnoDB` uses the clustered index to optimize the common lookup and DML operations.

> 每个“InnoDB”表都有一个特殊的索引，称为聚簇索引，用于存储行数据。通常，聚簇索引与主键同义。为了从查询、插入和其他数据库操作中获得最佳性能，了解“InnoDB”如何使用聚簇索引来优化常见的查找和 DML 操作非常重要。

- When you define a `PRIMARY KEY` on a table, `InnoDB` uses it as the clustered index. A primary key should be defined for each table. If there is no logical unique and non-null column or set of columns to use a the primary key, add an auto-increment column. Auto-increment column values are unique and are added automatically as new rows are inserted.

  >当在表上定义 `PRIMARY KEY` 时，`InnoDB` 将其作为聚簇索引。应该为每个表定义一个主键。如果没有逻辑唯一且非空的列作为主键，请添加自增列。自增列值是唯一的，并在插入新行时自动添加。

- If you do not define a `PRIMARY KEY` for a table, `InnoDB` uses the first `UNIQUE` index with all key columns defined as `NOT NULL` as the clustered index.

  > 如果没有为表定义 `PRIMARY KEY`，`InnoDB` 使用第一个 `UNIQUE` 索引，所有键列都定义为 `NOT NULL` 作为聚簇索引。

- If a table has no `PRIMARY KEY` or suitable `UNIQUE` index, `InnoDB` generates a hidden clustered index named `GEN_CLUST_INDEX` on a synthetic column that contains row ID values. The rows are ordered by the row ID that `InnoDB` assigns. The row ID is a 6-byte field that increases monotonically as new rows are inserted. Thus, the rows ordered by the row ID are physically in order of insertion.

  > 如果表没有`PRIMARY KEY`或合适的`UNIQUE`索引，`InnoDB`会在包含row ID 值的合成列上生成名为`GEN_CLUST_INDEX`的隐藏聚簇索引。这些行按`InnoDB`分配的row ID 排序。row ID 是一个 6 字节的字段，随着新行的插入而单调增加。因此，按row id 排序的行在物理上是按插入顺序排列的。

##### How the Clustered Index Speeds Up Queries

Accessing a row through the clustered index is fast because the index search leads directly to the page that contains the row data. If a table is large, the clustered index architecture often saves a disk I/O operation when compared to storage organizations that store row data using a different page from the index record.

> 通过聚簇索引访问行很快，因为索引搜索直接指向包含行数据的页面。如果表很大，使用与索引记录不同的页面存储方式的存储架构相比，聚簇索引架构通常会节省磁盘 I/O 操作。

##### How Secondary Indexes Relate to the Clustered Index

Indexes other than the clustered index are known as secondary indexes. In `InnoDB`, each record in a secondary index contains the primary key columns for the row, as well as the columns specified for the secondary index. `InnoDB` uses this primary key value to search for the row in the clustered index.

>聚簇索引以外的索引称为二级索引。在“InnoDB”中，二级索引中的每条记录都包含行的主键列，以及为二级索引指定的列。 `InnoDB` 使用这个主键值来搜索聚簇索引中的行。

If the primary key is long, the secondary indexes use more space, so it is advantageous to have a short primary key.

>如果主键很长，二级索引会占用更多空间，所以主键短是有利的。

For guidelines to take advantage of `InnoDB` clustered and secondary indexes, see [Section 8.3, “Optimization and Indexes”](https://dev.mysql.com/doc/refman/8.0/en/optimization-indexes.html).