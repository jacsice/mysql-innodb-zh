#### 15.6.3.2 File-Per-Table Tablespaces

A file-per-table tablespace contains data and indexes for a single `InnoDB` table, and is stored on the file system in a single data file.

> file-per-table 表空间包含单个“InnoDB”表的数据和索引，并存储在文件系统中的单个数据文件中。

##### File-Per-Table Tablespace Configuration

`InnoDB` creates tables in file-per-table tablespaces by default. This behavior is controlled by the [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table) variable. Disabling [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table) causes `InnoDB` to create tables in the system tablespace.

> `InnoDB` 默认在 file-per-table 表空间中创建表。此行为由 [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table) 变量控制。禁用 [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table) 会导致 `InnoDB` 在系统表空间中创建表。

An [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table) setting can be specified in an option file or configured at runtime using a [`SET GLOBAL`](https://dev.mysql.com/doc/refman/8.0/en/set-variable.html) statement. Changing the setting at runtime requires privileges sufficient to set global system variables. See [Section 5.1.9.1, “System Variable Privileges”](https://dev.mysql.com/doc/refman/8.0/en/system-variable-privileges.html).

>可以在option文件中配置 [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table) 或在运行时使用 [`SET GLOBAL`](https://dev.mysql.com/doc/refman/8.0/en/set-variable.html) 。在运行时更改设置需要足够的权限来设置全局系统变量。

Option file:

```ini
[mysqld]
innodb_file_per_table=ON
```

Using [`SET GLOBAL`](https://dev.mysql.com/doc/refman/8.0/en/set-variable.html) at runtime:

```sql
mysql> SET GLOBAL innodb_file_per_table=ON;
```

##### File-Per-Table Tablespace Data Files

A file-per-table tablespace is created in an `.ibd` data file in a schema directory under the MySQL data directory. The `.ibd` file is named for the table (`*`table_name`*.ibd`). For example, the data file for table `test.t1` is created in the `test` directory under the MySQL data directory:

> 在 MySQL 数据目录下的模式目录中的 .ibd 数据文件中创建一个 file-per-table 表空间。 `.ibd` 文件以表命名（`*`table_name`*.ibd`）。例如，表 `test.t1` 的数据文件是在 MySQL 数据目录下的 `test` 目录中创建的：

```sql
mysql> USE test;

mysql> CREATE TABLE t1 (
   id INT PRIMARY KEY AUTO_INCREMENT,
   name VARCHAR(100)
 ) ENGINE = InnoDB;

$> cd /path/to/mysql/data/test
$> ls
t1.ibd
```

You can use the `DATA DIRECTORY` clause of the [`CREATE TABLE`](https://dev.mysql.com/doc/refman/8.0/en/create-table.html) statement to implicitly create a file-per-table tablespace data file outside of the data directory. For more information, see [Section 15.6.1.2, “Creating Tables Externally”](https://dev.mysql.com/doc/refman/8.0/en/innodb-create-table-external.html).

##### File-Per-Table Tablespace Advantages

File-per-table tablespaces have the following advantages over shared tablespaces such as the system tablespace or general tablespaces.

>File-per-table 表空间与共享表空间（如系统表空间或通用表空间）相比具有以下优点。

- Disk space is returned to the operating system after truncating or dropping a table created in a file-per-table tablespace. Truncating or dropping a table stored in a shared tablespace creates free space within the shared tablespace data file, which can only be used for `InnoDB` data. In other words, a shared tablespace data file does not shrink in size after a table is truncated or dropped.

> 在截断或删除在 file-per-table 表空间中创建的表后，磁盘空间将释放给操作系统。截断或删除存储在共享表空间中的表会在共享表空间数据文件中创建可用空间，该空间只能用于`InnoDB`数据。换句话说，共享表空间数据文件在表被截断或删除后不会缩小。

- A table-copying [`ALTER TABLE`](https://dev.mysql.com/doc/refman/8.0/en/alter-table.html) operation on a table that resides in a shared tablespace can increase the amount of disk space occupied by the tablespace. Such operations may require as much additional space as the data in the table plus indexes. This space is not released back to the operating system as it is for file-per-table tablespaces.

> 对驻留在共享表空间中的表的表复制 [`ALTER TABLE`](https://dev.mysql.com/doc/refman/8.0/en/alter-table.html) 操作会增加表空间所占用的磁盘空间。此类操作可能需要与表中的数据加上索引一样多的额外空间。该空间不会像 file-per-table 表空间那样释放回操作系统。

- [`TRUNCATE TABLE`](https://dev.mysql.com/doc/refman/8.0/en/truncate-table.html) performance is better when executed on tables that reside in file-per-table tablespaces.

> [`TRUNCATE TABLE`](https://dev.mysql.com/doc/refman/8.0/en/truncate-table.html) 在驻留在 file-per-table 表空间中的表上执行时性能更好。

- File-per-table tablespace data files can be created on separate storage devices for I/O optimization, space management, or backup purposes. See [Section 15.6.1.2, “Creating Tables Externally”](https://dev.mysql.com/doc/refman/8.0/en/innodb-create-table-external.html).

> File-per-table 表空间数据文件可以在单独的存储设备上创建，用于 I/O 优化、空间管理或备份目的

- You can import a table that resides in file-per-table tablespace from another MySQL instance. See [Section 15.6.1.3, “Importing InnoDB Tables”](https://dev.mysql.com/doc/refman/8.0/en/innodb-table-import.html).

>可以从另一个 MySQL 实例导入驻留在 file-per-table 表空间中的表。

- Tables created in file-per-table tablespaces support features associated with `DYNAMIC` and `COMPRESSED` row formats, which are not supported by the system tablespace. See [Section 15.10, “InnoDB Row Formats”](https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html).

>在 file-per-table 表空间中创建的表支持与 `DYNAMIC` 和 `COMPRESSED` 行格式相关的功能，系统表空间不支持这些功能

- Tables stored in individual tablespace data files can save time and improve chances for a successful recovery when data corruption occurs, when backups or binary logs are unavailable, or when the MySQL server instance cannot be restarted.

> 当发生数据损坏、备份或二进制日志不可用或 MySQL 服务器实例无法重新启动时，存储在file-per-table表空间中的表可以节省时间并提高成功恢复的机会。

- Tables created in file-per-table tablespaces can be backed up or restored quickly using MySQL Enterprise Backup, without interrupting the use of other `InnoDB` tables. This is beneficial for tables on varying backup schedules or that require backup less frequently. See [Making a Partial Backup](https://dev.mysql.com/doc/mysql-enterprise-backup/8.0/en/partial.html) for details.

> 在 file-per-table 表空间中创建的表可以使用 MySQL Enterprise Backup 快速备份或恢复，而不会中断其他“InnoDB”表的使用。这对于备份计划不同或需要较少备份的表很有用

- File-per-table tablespaces permit monitoring table size on the file system by monitoring the size of the tablespace data file.

>File-per-table 表空间允许通过监视表空间数据文件的大小来监视文件系统上的表大小。

- Common Linux file systems do not permit concurrent writes to a single file such as a shared tablespace data file when [`innodb_flush_method`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_flush_method) is set to `O_DIRECT`. As a result, there are possible performance improvements when using file-per-table tablespaces in conjunction with this setting.

> 当 [`innodb_flush_method`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html) 设置为 `O_DIRECT`时，常见的 Linux 文件系统不允许并发写单个文件，例如共享表空间数据文件 。因此，将 file-per-table 表空间与此设置结合使用时，可能会提高性能。

- Tables in a shared tablespace are limited in size by the 64TB tablespace size limit. By comparison, each file-per-table tablespace has a 64TB size limit, which provides plenty of room for individual tables to grow in size.

> 共享表空间中的表的大小受 64TB 表空间大小限制。相比之下，每个 file-per-table 表空间的大小限制为 64TB，这为各个表的大小增长提供了充足的空间。

##### File-Per-Table Tablespace Disadvantages

File-per-table tablespaces have the following disadvantages compared to shared tablespaces such as the system tablespace or general tablespaces.

- With file-per-table tablespaces, each table may have unused space that can only be utilized by rows of the same table, which can lead to wasted space if not properly managed.

> 使用 file-per-table 表空间，每个表可能有未使用的空间，只能由同一个表的行使用，如果管理不当，可能会导致空间浪费。

- `fsync` operations are performed on multiple file-per-table data files instead of a single shared tablespace data file. Because `fsync` operations are per file, write operations for multiple tables cannot be combined, which can result in a higher total number of `fsync` operations.

>fsync 操作是在多个 file-per-table 数据文件上执行而不是一个共享表空间数据文件上。因为 `fsync` 操作是针对每个文件的，所以不能合并多个表的写入操作，这会导致 `fsync` 操作的总数增加。

- [**mysqld**](https://dev.mysql.com/doc/refman/8.0/en/mysqld.html) must keep an open file handle for each file-per-table tablespace, which may impact performance if you have numerous tables in file-per-table tablespaces.

>[**mysqld**](https://dev.mysql.com/doc/refman/8.0/en/mysqld.html) 必须为每个 file-per-table 表空间保留一个打开的文件句柄，这可能会影响性能，如果在 file-per-table 表空间中有许多表。

- More file descriptors are required when each table has its own data file.

>当每个表都有自己的数据文件时，需要更多的文件描述符。

- There is potential for more fragmentation, which can impede [`DROP TABLE`](https://dev.mysql.com/doc/refman/8.0/en/drop-table.html) and table scan performance. However, if fragmentation is managed, file-per-table tablespaces can improve performance for these operations.

>可能会出现更多碎片，这可能会阻碍 [`DROP TABLE`](https://dev.mysql.com/doc/refman/8.0/en/drop-table.html) 和表扫描性能。然而，如果碎片是被管理的，file-per-table 表空间可以提高这些操作的性能。

- The buffer pool is scanned when dropping a table that resides in a file-per-table tablespace, which can take several seconds for large buffer pools. The scan is performed with a broad internal lock, which may delay other operations.

>删除驻留在file-per-table表空间中的表时会扫描缓冲池，这对于大型缓冲池可能需要几秒钟。使用broad internal lock执行扫描，这可能会延迟其他操作。

- The [`innodb_autoextend_increment`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_autoextend_increment) variable, which defines the increment size for extending the size of an auto-extending shared tablespace file when it becomes full, does not apply to file-per-table tablespace files, which are auto-extending regardless of the [`innodb_autoextend_increment`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_autoextend_increment) setting. Initial file-per-table tablespace extensions are by small amounts, after which extensions occur in increments of 4MB.

>[`innodb_autoextend_increment`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_autoextend_increment) 变量，它定义了当一个自动扩展的共享表空间变满的时候扩展的大小，不适用于file-per-table空间文件，无论 `innodb_autoextend_increment`如何配置，这些文件都会自动扩展。最初的 file-per-table 表空间扩展是少量的，之后以 4MB 为增量扩展。